<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>浪漫圣诞树 · 摄像头测试</title>
  <style>
    body{margin:0;background:#0b1020;color:#fff;font-family:-apple-system,Segoe UI,Helvetica,Arial;overflow:hidden}
    .app{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100vh}
    header{padding:12px;text-align:center}
    .title{font-size:20px;font-weight:bold;color:#ffeaa7}
    .canvas-wrap{position:relative;width:100%;max-width:480px;aspect-ratio:9/16;margin:8px auto;border-radius:12px;overflow:hidden}
    canvas{position:absolute;inset:0;width:100%;height:100%}
    .message-card{position:absolute;bottom:14px;left:50%;transform:translateX(-50%);width:90%;background:rgba(0,0,0,.5);padding:8px;border-radius:10px;display:flex;gap:8px}
    .input{flex:1;padding:8px;border-radius:8px;border:none}
    .btn{padding:8px 12px;border:none;border-radius:8px;background:#ff8fb3;color:#000;font-weight:bold}
    #videoWrap{margin-top:12px;text-align:center}
    video{width:90%;max-width:480px;border:2px solid #fff;border-radius:12px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">圣诞树 + 摄像头</div>
      <p>点击按钮可以在手机上打开摄像头</p>
    </header>

    <div class="canvas-wrap">
      <canvas id="stage"></canvas>
      <div class="message-card">
        <input id="msg" class="input" placeholder="写一句话放到树心里" />
        <button class="btn" id="apply">放到树上</button>
      </div>
    </div>

    <div id="videoWrap">
      <button class="btn" onclick="openCam()">打开摄像头</button><br>
      <video id="video" autoplay playsinline></video>
    </div>
  </div>

  <script>
    // ====== 圣诞树动画（简化版） ======
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');
    let W=360,H=640;
    function fit(){
      const rect=canvas.parentElement.getBoundingClientRect();
      W=rect.width;H=rect.height;
      canvas.width=W;canvas.height=H;
    }
    fit();window.addEventListener('resize',fit);

    let message="Merry Christmas";
    function draw(){
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle="#135c3a";
      ctx.beginPath();
      ctx.moveTo(W/2,H*0.2);
      ctx.lineTo(W/2-100,H*0.8);
      ctx.lineTo(W/2+100,H*0.8);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle="#ffd86b";
      ctx.font="20px sans-serif";
      ctx.textAlign="center";
      ctx.fillText(message,W/2,H*0.5);
      requestAnimationFrame(draw);
    }
    draw();
    document.getElementById('apply').onclick=()=>{
      const v=document.getElementById('msg').value.trim();
      if(v) message=v;
    };

    // ====== 摄像头调用 ======
    async function openCam(){
      try{
        const stream=await navigator.mediaDevices.getUserMedia({video:true});
        document.getElementById('video').srcObject=stream;
      }catch(err){
        alert("无法访问摄像头: "+err.message);
      }
    }
  </script>
</body>
</html>
